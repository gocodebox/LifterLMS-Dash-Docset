<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head>
	<meta charset="UTF-8"/>
	<link rel="profile" href="https://gmpg.org/xfn/11"/>
	<link rel="dns-prefetch" href="/s.w.org"/>
	<link rel="dns-prefetch" href="/fonts.googleapis.com"/>
	<link rel="dns-prefetch" href="/fonts.gstatic.com"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>

	<link href="../../../../s29765.pcdn.co/wp-includes/css/dashicons.min.css" rel="stylesheet" type="text/css"/>
	<link href="/fonts.googleapis.com/css?family=Montserrat:300,300i,600,600i" rel="stylesheet" type="text/css"/>

	<link rel="icon" href="../../../../s26875.pcdn.co/wp-content/uploads/2019/02/lifterlms-icon-square-150x150.png" sizes="32x32"/>
	<link rel="icon" href="../../../../s26875.pcdn.co/wp-content/uploads/2019/02/lifterlms-icon-square-300x300.png" sizes="192x192"/>
	<link rel="apple-touch-icon-precomposed" href="../../../../s26875.pcdn.co/wp-content/uploads/2019/02/lifterlms-icon-square-300x300.png"/>
	<meta name="msapplication-TileImage" content="https://s26875.pcdn.co/wp-content/uploads/2019/02/lifterlms-icon-square-300x300.png"/>
	<script>document.cookie='devicePixelRatio='+((window.devicePixelRatio === undefined) ? 1 : window.devicePixelRatio)+'; path=/';</script>
	<title>LLMS_Admin_Builder - LifterLMS Developer Hub</title>

<!-- This site is optimized with the Yoast SEO plugin v10.0 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="robots" content="noindex,follow"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:type" content="article"/>
<meta property="og:title" content="LLMS_Admin_Builder - LifterLMS Developer Hub"/>
<meta property="og:description" content="LLMS_Admin_Builder class."/>
<meta property="og:url" content="https://developer.lifterlms.com/reference/classes/llms_admin_builder/"/>
<meta property="og:site_name" content="LifterLMS Developer Hub"/>
<meta property="article:publisher" content="https://www.facebook.com/lifterlms"/>
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:description" content="LLMS_Admin_Builder class."/>
<meta name="twitter:title" content="LLMS_Admin_Builder - LifterLMS Developer Hub"/>
<meta name="twitter:site" content="@lifterlms"/>
<meta name="twitter:creator" content="@lifterlms"/>
<script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","url":"https://developer.lifterlms.com/","sameAs":["https://www.facebook.com/lifterlms","https://www.instagram.com/lifterlms/","https://www.youtube.com/user/lifterlms","https://twitter.com/lifterlms"],"@id":"https://developer.lifterlms.com/#organization","name":"LifterLMS","logo":"https://s29765.pcdn.co/wp-content/uploads/2019/03/lifterlms-logo.png"}</script>
<!-- / Yoast SEO plugin. -->

<link rel="dns-prefetch" href="/s.w.org"/>
<link rel="alternate" type="application/rss+xml" title="LifterLMS Developer Hub &raquo; Feed" href="https://developer.lifterlms.com/feed/"/>
<link rel="alternate" type="application/rss+xml" title="LifterLMS Developer Hub &raquo; Comments Feed" href="https://developer.lifterlms.com/comments/feed/"/>
<link rel="alternate" type="application/rss+xml" title="LifterLMS Developer Hub &raquo; LLMS_Admin_Builder Comments Feed" href="https://developer.lifterlms.com/reference/classes/llms_admin_builder/feed/"/>
<!-- This site uses the Google Analytics by MonsterInsights plugin v7.4.2 - Using Analytics tracking - https://www.monsterinsights.com/ -->
<script type="text/javascript" data-cfasync="false">
	var mi_version         = '7.4.2';
	var mi_track_user      = true;
	var mi_no_track_reason = '';
	
	var disableStr = 'ga-disable-UA-40371053-3';

	/* Function to detect opted out users */
	function __gaTrackerIsOptedOut() {
		return document.cookie.indexOf(disableStr + '=true') > -1;
	}

	/* Disable tracking if the opt-out cookie exists. */
	if ( __gaTrackerIsOptedOut() ) {
		window[disableStr] = true;
	}

	/* Opt-out function */
	function __gaTrackerOptout() {
	  document.cookie = disableStr + '=true; expires=Thu, 31 Dec 2099 23:59:59 UTC; path=/';
	  window[disableStr] = true;
	}
	
	if ( mi_track_user ) {
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','__gaTracker');

		__gaTracker('create', 'UA-40371053-3', 'auto');
		__gaTracker('set', 'forceSSL', true);
		__gaTracker('require', 'displayfeatures');
		__gaTracker('require', 'linkid', 'linkid.js');
		__gaTracker('send','pageview');
	} else {
		console.log( "" );
		(function() {
			/* https://developers.google.com/analytics/devguides/collection/analyticsjs/ */
			var noopfn = function() {
				return null;
			};
			var noopnullfn = function() {
				return null;
			};
			var Tracker = function() {
				return null;
			};
			var p = Tracker.prototype;
			p.get = noopfn;
			p.set = noopfn;
			p.send = noopfn;
			var __gaTracker = function() {
				var len = arguments.length;
				if ( len === 0 ) {
					return;
				}
				var f = arguments[len-1];
				if ( typeof f !== 'object' || f === null || typeof f.hitCallback !== 'function' ) {
					console.log( 'Not running function __gaTracker(' + arguments[0] + " ....) because you are not being tracked. " + mi_no_track_reason );
					return;
				}
				try {
					f.hitCallback();
				} catch (ex) {

				}
			};
			__gaTracker.create = function() {
				return new Tracker();
			};
			__gaTracker.getByName = noopnullfn;
			__gaTracker.getAll = function() {
				return [];
			};
			__gaTracker.remove = noopfn;
			window['__gaTracker'] = __gaTracker;
					})();
		}
</script>
<!-- / Google Analytics by MonsterInsights -->
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/s29765.pcdn.co\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.0.3"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel="stylesheet" id="wp-block-library-css" href="../../../../s29765.pcdn.co/wp-includes/css/dist/block-library/style.min.css" type="text/css" media="all"/>
<link rel="stylesheet" id="wporg-handbook-css-css" href="../../../../s29765.pcdn.co/wp-content/plugins/handbook/stylesheets/callout-boxes.css" type="text/css" media="all"/>
<link rel="stylesheet" id="main-css" href="../../../../s29765.pcdn.co/wp-content/themes/wporg-developer/stylesheets/main.css" type="text/css" media="all"/>
<link rel="stylesheet" id="dashdocs-css" href="../../../../s29765.pcdn.co/wp-content/themes/wporg-developer/stylesheets/dashdocs.css" type="text/css" media="all"/>
<link rel="stylesheet" id="awesomplete-css-css" href="../../../../s29765.pcdn.co/wp-content/themes/wporg-developer/stylesheets/awesomplete.css" type="text/css" media="all"/>
<link rel="stylesheet" id="autocomplete-css-css" href="../../../../s29765.pcdn.co/wp-content/themes/wporg-developer/stylesheets/autocomplete.css" type="text/css" media="all"/>
<link rel="stylesheet" id="syntaxhighlighter-core-css" href="../../../../s29765.pcdn.co/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css" type="text/css" media="all"/>
<link rel="stylesheet" id="syntaxhighlighter-theme-default-css" href="../../../../s29765.pcdn.co/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css" type="text/css" media="all"/>
<script type="text/javascript">
/* <![CDATA[ */
var monsterinsights_frontend = {"js_events_tracking":"true","download_extensions":"doc,exe,js,pdf,ppt,tgz,zip,xls","inbound_paths":"[]","home_url":"https:\/\/developer.lifterlms.com","hash_tracking":"false"};
/* ]]> */
</script>
<script type="text/javascript" src="../../../../s29765.pcdn.co/wp-content/plugins/google-analytics-for-wordpress/assets/js/frontend.js"></script>
<script type="text/javascript" src="../../../../s29765.pcdn.co/wp-includes/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../../../../s29765.pcdn.co/wp-includes/js/jquery/jquery-migrate.min.js"></script>
<script type="text/javascript" src="../../../../s29765.pcdn.co/wp-content/plugins/handbook/scripts/handbook.js"></script>
<script type="text/javascript" src="../../../../s29765.pcdn.co/wp-content/themes/wporg-developer/js/chapters.js"></script>
<script type="text/javascript" src="../../../../s29765.pcdn.co/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js"></script>
<script type="text/javascript" src="../../../../s29765.pcdn.co/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPhp.js"></script>
<link rel="https://api.w.org/" href="https://developer.lifterlms.com/wp-json/"/>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://developer.lifterlms.com/xmlrpc.php?rsd"/>
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://s29765.pcdn.co/wp-includes/wlwmanifest.xml"/> 
<meta name="generator" content="WordPress 5.0.3"/>
<link rel="shortlink" href="https://developer.lifterlms.com/?p=5817"/>
<link rel="alternate" type="application/json+oembed" href="https://developer.lifterlms.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fdeveloper.lifterlms.com%2Freference%2Fclasses%2Fllms_admin_builder%2F"/>
<link rel="alternate" type="text/xml+oembed" href="https://developer.lifterlms.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fdeveloper.lifterlms.com%2Freference%2Fclasses%2Fllms_admin_builder%2F&amp;format=xml"/>
		<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
		
	<script type="text/javascript">
		jQuery( '<style>.hide-if-js { display: none; }</style>' ).appendTo( 'head' );
		jQuery( function($) {
			$( 'body' ).addClass('js');
		} );
	</script>
<style type="text/css" id="syntaxhighlighteranchor"></style>
</head>

<body id="wordpress-org" class="wp-parser-class-template-default single single-wp-parser-class postid-5817">

	<div id="header">

		<nav class="network-menu"><ul id="menu-main" class="menu"><li id="menu-item-7906" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7906"><a href="https://lifterlms.com">LifterLMS</a></li>
<li id="menu-item-7909" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7909"><a href="https://lifterlms.com/docs/">Knowledge Base</a></li>
<li id="menu-item-7910" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7910"><a href="https://academy.lifterlms.com/">Academy</a></li>
<li id="menu-item-7911" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7911"><a href="https://blog.lifterlms.com/">Blog</a></li>
<li id="menu-item-7912" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7912"><a href="https://podcast.lifterlms.com/">Podcast</a></li>
<li id="menu-item-7913" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7913"><a href="https://make.lifterlms.com/">Contributors</a></li>
</ul></nav>
		<div class="wrapper">
			<h1>
				<a href="https://lifterlms.com/">
					<span class="screen-reader-text">LifterLMS</span>
					<img class="header-logo" src="../../../../s27051.pcdn.co/wp-content/uploads/2019/02/lifterlms_logo.png" alt="LifterLMS"/>
				</a>
			</h1>

		</div>

	</div>



<header id="masthead" class="site-header" role="banner">
		<div class="site-branding">
		<h1 class="site-title">
			<a href="https://developer.lifterlms.com/reference/" rel="home">Code Reference</a>
		</h1>

		
		<nav id="site-navigation" class="main-navigation" role="navigation">
			<button class="menu-toggle dashicons dashicons-arrow-down-alt2" aria-controls="primary-menu" aria-expanded="false" aria-label="Primary Menu"></button>
			<div id="primary-menu" class="menu-container"><ul id="menu-dev-resources" class="menu"><li id="menu-item-7915" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-home menu-item-7915"><a href="https://developer.lifterlms.com/">Home</a></li>
<li id="menu-item-7914" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7914"><a href="https://developer.lifterlms.com/reference/">Code Reference</a></li>
</ul></div>		</nav>
	</div>
</header><!-- #masthead -->

<div id="page" class="hfeed site devhub-wrap">
	<a href="#main" class="screen-reader-text">Skip to content</a>

								<div id="inner-search">
					<div class="search-section section clear hide-if-js">


	
	<form role="search" method="get" class="searchform searchform-filtered" action="https://developer.lifterlms.com/">
		<label for="search-field" class="screen-reader-text">Search for:</label>
		<input type="text" id="search-field" class="search-field" placeholder="Search &hellip;" value="" name="s"/>
		<button class="button button-primary button-search"><i class="dashicons dashicons-search"></i><span class="screen-reader-text">Search plugins</span></button>
	
		<div class="search-post-type">
			<span>Filter by type:</span>
									<label><input type="checkbox" name="post_type[]" value="wp-parser-function"/> Functions</label>
									<label><input type="checkbox" name="post_type[]" value="wp-parser-hook"/> Hooks</label>
									<label><input type="checkbox" name="post_type[]" value="wp-parser-class"/> Classes</label>
									<label><input type="checkbox" name="post_type[]" value="wp-parser-method"/> Methods</label>
					</div>

	
	</form>

</div><!-- /search-guide -->
					<div id="inner-search-icon-container">
						<div id="inner-search-icon">
							<div class="dashicons dashicons-search"><span class="screen-reader-text">Search</span></div>
						</div>
					</div>
				</div>

				<div id="content" class="site-content">

	<div id="content-area" class="wp-parser-class-template-default single single-wp-parser-class postid-5817 code-reference">

		
		<div class="breadcrumb-trail breadcrumbs" itemprop="breadcrumb">
			<span class="trail-browse">Browse:</span> 
			<span class="trail-begin"><a href="https://developer.lifterlms.com" title="LifterLMS Developer Hub" rel="home">Home</a></span> <span class="sep">/</span> 
			<span class="trail-inner"><a href="https://developer.lifterlms.com/reference/" title="Code Reference">Code Reference</a></span> <span class="sep">/</span> 
			<span class="trail-inner"><a href="https://developer.lifterlms.com/reference/classes/">Classes</a></span> <span class="sep">/</span> <a class="dashingAutolink" name="autolink-101"></a><a class="dashAnchor" name="//apple_ref/cpp/Class/LLMS_Admin_Builder"></a><span class="trail-end">LLMS_Admin_Builder</span>
		</div>
		<main id="main" class="site-main" role="main">

		
			
<article id="post-5817" class="post-5817 wp-parser-class type-wp-parser-class status-publish hentry wp-parser-source-file-includes_admin_class-llms-admin-builder-php">

	
	
	<h1>LLMS_Admin_Builder</h1>

	<section class="summary">
		<p><a href="https://developer.lifterlms.com/reference/classes/llms_admin_builder/">LLMS_Admin_Builder</a> class.</p>
	</section>


	
	<div class="content-toc"><style> .toc-jump { text-align: right; font-size: 12px; } .page .toc-heading { margin-top: -50px; padding-top: 50px !important; }</style><div class="table-of-contents"><h2>Contents</h2><ul class="items"><li><a href="#description">Description</a>
<ul>
<li><a href="#source">Source</a>
</li></ul></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#user-contributed-notes">User Contributed Notes</a></li></ul>
</div>

<hr/>
<section class="description">
	<h2 class="toc-heading" id="description" tabindex="-1">Description <a href="#description" class="anchor"><span aria-hidden="true">#</span><span class="screen-reader-text">Description</span></a></h2>
	
	</section>

	<hr/>
	<section class="source-content">
		<h3 class="toc-heading" id="source" tabindex="-1">Source <a href="#source" class="anchor"><span aria-hidden="true">#</span><span class="screen-reader-text">Source</span></a></h3>
		<p>
			File: <a href="https://developer.lifterlms.com/reference/files/includes/admin/class-llms-admin-builder.php/">includes/admin/class.llms.admin.builder.php</a>		</p>

					<div class="source-code-container">
				<pre class="brush: php; toolbar: false; first-line: 13">class LLMS_Admin_Builder {

	private static $search_term = &#39;&#39;;

	/**
	 * Add menu items to the WP Admin Bar to allow quiz returns to the dashboad from the course builder
	 * @param    obj     $wp_admin_bar  Instance of WP_Admin_Bar
	 * @return   void
	 * @since    3.16.7
	 * @version  3.24.0
	 */
	public static function admin_bar_menu( $wp_admin_bar ) {

		// partially lifted from `wp_admin_bar_site_menu()` in wp-includes/admin-bar.php
		if ( current_user_can( &#39;read&#39; ) ) {

			$wp_admin_bar-&gt;add_menu(
				array(
					&#39;parent&#39; =&gt; &#39;site-name&#39;,
					&#39;id&#39;     =&gt; &#39;dashboard&#39;,
					&#39;title&#39;  =&gt; __( &#39;Dashboard&#39;, &#39;lifterlms&#39; ),
					&#39;href&#39;   =&gt; admin_url(),
				)
			);

			$wp_admin_bar-&gt;add_menu(
				array(
					&#39;parent&#39; =&gt; &#39;site-name&#39;,
					&#39;id&#39;     =&gt; &#39;llms-courses&#39;,
					&#39;title&#39;  =&gt; __( &#39;Courses&#39;, &#39;lifterlms&#39; ),
					&#39;href&#39;   =&gt; admin_url( &#39;edit.php?post_type=course&#39; ),
				)
			);

			wp_admin_bar_appearance_menu( $wp_admin_bar );

		}

	}

	/**
	 * Retrieve custom field schemas
	 * @return   array
	 * @since    3.17.0
	 * @version  3.17.6
	 */
	private static function get_custom_schemas() {

		$quiz_fields = array();

		/**
		 * Handle old quiz layout compatibility API
		 * translate the old filter into the new one for quizzes
		 */
		if ( get_theme_support( &#39;lifterlms-quizzes&#39; ) ) {

			llms_log( &#39;Filter `llms_get_quiz_theme_settings` deprecated since 3.17.6, for more information see new methods at https://lifterlms.com/docs/course-builder-custom-fields-for-developers/&#39; );

			$theme = wp_get_theme();

			$old = llms_get_quiz_theme_setting( &#39;layout&#39; );

			$field = array(
				&#39;attribute&#39; =&gt; $old[&#39;id&#39;],
				&#39;id&#39; =&gt; $old[&#39;id&#39;],
				&#39;label&#39; =&gt; $old[&#39;name&#39;],
				&#39;type&#39; =&gt; ( &#39;select&#39; === $old[&#39;type&#39;] ) ? &#39;select&#39; : &#39;radio&#39;,
				&#39;options&#39; =&gt; $old[&#39;options&#39;],
			);

			if ( isset( $old[&#39;id_prefix&#39;] ) ) {
				$field[&#39;attribute_prefix&#39;] = $old[&#39;id_prefix&#39;];
			}

			$quiz_fields[ sprintf( &#39;%s_backwards_theme_group&#39;, $theme-&gt;get_stylesheet() ) ] = array(
				&#39;title&#39; =&gt; sprintf( __( &#39;%s Theme Settings&#39;, &#39;lifterlms&#39; ), $theme-&gt;get( &#39;Name&#39; ) ),
				&#39;toggleable&#39; =&gt; true,
				&#39;fields&#39; =&gt; array( array( $field ) ),
			);

		}
		// end backwards compat

		return apply_filters( &#39;llms_builder_register_custom_fields&#39;, array(
			&#39;lesson&#39; =&gt; array(),
			&#39;quiz&#39; =&gt; $quiz_fields,
		) );
	}

	/**
	 * Retrieve a list of lessons the current user is allowed to clone/attach
	 * Used for ajax searching to add existing lessons
	 * @param    int        $course_id    WP Post ID of the course
	 * @param    string     $post_type    optionally search specific post type(s)
	 * @param    string     $search_term  optional search term (searches post_title)
	 * @param    integer    $page         page, used when paginating search results
	 * @return   array
	 * @since    3.14.8
	 * @version  3.16.12
	 */
	private static function get_existing_posts( $course_id, $post_type = &#39;&#39;, $search_term = &#39;&#39;, $page = 1 ) {

		$args = array(
			&#39;order&#39; =&gt; &#39;ASC&#39;,
			&#39;orderby&#39; =&gt; &#39;post_title&#39;,
			&#39;paged&#39; =&gt; $page,
			&#39;post_status&#39; =&gt; array( &#39;publish&#39;, &#39;draft&#39;, &#39;pending&#39; ),
			&#39;posts_per_page&#39; =&gt; 10,
		);

		if ( $post_type ) {
			$args[&#39;post_type&#39;] = $post_type;
		}

		if ( ! current_user_can( &#39;manage_options&#39; ) ) {

			$instructor = llms_get_instructor();
			$parents = $instructor-&gt;get( &#39;parent_instructors&#39; );
			if ( ! $parents ) {
				$parents = array();
			}

			$args[&#39;author__in&#39;] = array_unique( array_merge(
				array( get_current_user_id() ),
				$instructor-&gt;get_assistants(),
				$parents
			) );

		}

		self::$search_term = $search_term;
		add_filter( &#39;posts_where&#39;, array( __CLASS__, &#39;get_existing_posts_where&#39; ), 10, 2 );
		$query = new WP_Query( $args );
		remove_filter( &#39;posts_where&#39;, array( __CLASS__, &#39;get_existing_posts_where&#39; ), 10, 2 );

		$posts = array();

		if ( $query-&gt;have_posts() ) {

			foreach ( $query-&gt;posts as $post ) {

				$post = llms_get_post( $post );

				$parents = array();

				if ( method_exists( $post, &#39;is_orphan&#39; ) &amp;&amp; $post-&gt;is_orphan() ) {

					$action = &#39;attach&#39;;

				} else {

					$action = &#39;clone&#39;;

					$course_id = false;
					$lesson_id = false;

					if ( &#39;lesson&#39; === $post-&gt;get( &#39;type&#39; ) ) {
						$course_id = $post-&gt;get( &#39;parent_course&#39; );
					} elseif ( &#39;llms_quiz&#39; === $post-&gt;get( &#39;type&#39; ) ) {
						$lesson_id = $post-&gt;get( &#39;lesson_id&#39; );
						$course = $post-&gt;get_course();
						if ( $course ) {
							$course_id = $course-&gt;get( &#39;id&#39; );
						}
					}

					if ( $lesson_id ) {
						$parents[&#39;lesson&#39;] = sprintf( __( &#39;Lesson: %1$s (#%2$d)&#39;, &#39;lifterlms&#39; ), &#39;&lt;em&gt;&#39; . get_the_title( $lesson_id ) . &#39;&lt;/em&gt;&#39;, $lesson_id );
					}
					if ( $course_id ) {
						$parents[&#39;course&#39;] = sprintf( __( &#39;Course: %1$s (#%2$d)&#39;, &#39;lifterlms&#39; ), &#39;&lt;em&gt;&#39; . get_the_title( $course_id ) . &#39;&lt;/em&gt;&#39;, $course_id );
					}
				}

				$posts[] = array(
					&#39;action&#39; =&gt; $action,
					&#39;data&#39; =&gt; $post,
					&#39;id&#39; =&gt; $post-&gt;get( &#39;id&#39; ),
					&#39;parents&#39; =&gt; $parents,
					&#39;text&#39; =&gt; sprintf( &#39;%1$s (#%2$d)&#39;, $post-&gt;get( &#39;title&#39; ), $post-&gt;get( &#39;id&#39; ) ),
				);

			}// End foreach().
		}// End if().

		$ret = array(
			&#39;results&#39; =&gt; $posts,
			&#39;pagination&#39; =&gt; array(
				&#39;more&#39; =&gt; ( $page &lt; $query-&gt;max_num_pages ),
			),
		);

		return $ret;

	}

	/**
	 * Search lessons by search term during existing lesson lookups
	 * @param    string     $where      existing sql where clause
	 * @param    obj        $wp_query   WP_Query
	 * @return   string
	 * @since    3.14.8
	 * @version  3.16.12
	 */
	public function get_existing_posts_where( $where, $wp_query ) {

		if ( self::$search_term ) {
			global $wpdb;
			$where .= &#39; AND &#39; . $wpdb-&gt;posts . &#39;.post_title LIKE &#34;%&#39; . esc_sql( $wpdb-&gt;esc_like( self::$search_term ) ) . &#39;%&#34;&#39;;
		}

		return $where;

	}

	/**
	 * Retrieve the HTML of a JS template
	 * @param    [type]     $template  [description]
	 * @return   [type]
	 * @since    3.16.0
	 * @version  3.16.0
	 */
	private static function get_template( $template, $vars = array() ) {

		ob_start();
		extract( $vars );
		include &#39;views/builder/&#39; . $template . &#39;.php&#39;;
		return ob_get_clean();

	}

	/**
	 * A terrible Rest API for the course builder
	 * @shame    gimme a break pls
	 * @param    array     $request  $_REQUEST
	 * @return   array
	 * @since    3.13.0
	 * @version  3.19.2
	 */
	public static function handle_ajax( $request ) {

		// @todo do some real error handling here
		if ( ! $request[&#39;course_id&#39;] || ! current_user_can( &#39;edit_course&#39;, $request[&#39;course_id&#39;] ) ) {
			return array();
		}

		switch ( $request[&#39;action_type&#39;] ) {

			case &#39;ajax_save&#39;:

				if ( isset( $request[&#39;llms_builder&#39;] ) ) {

					$request[&#39;llms_builder&#39;] = stripslashes( $request[&#39;llms_builder&#39;] );
					wp_send_json( self::heartbeat_received( array(), $request ) );

				}

			break;

			case &#39;get_permalink&#39;:

				$id = isset( $request[&#39;id&#39;] ) ? absint( $request[&#39;id&#39;] ) : false;
				if ( ! $id ) {
					return array();
				}
				$title = isset( $request[&#39;title&#39;] ) ? sanitize_title( $request[&#39;title&#39;] ) : null;
				$slug = isset( $request[&#39;slug&#39;] ) ? sanitize_title( $request[&#39;slug&#39;] ) : null;
				$link = get_sample_permalink( $id, $title, $slug );
				wp_send_json( array(
					&#39;slug&#39; =&gt; $link[1],
					&#39;permalink&#39; =&gt; str_replace( &#39;%pagename%&#39;, $link[1], $link[0] ),
				) );

			break;

			case &#39;lazy_load&#39;:

				$ret = array();
				if ( isset( $request[&#39;load_id&#39;] ) ) {
					$post = llms_get_post( absint( $request[&#39;load_id&#39;] ) );
					$ret = $post-&gt;toArray();
				}
				wp_send_json( $ret );

			break;

			case &#39;search&#39;:
				$page = isset( $request[&#39;page&#39;] ) ? $request[&#39;page&#39;] : 1;
				$term = isset( $request[&#39;term&#39;] ) ? sanitize_text_field( $request[&#39;term&#39;] ) : &#39;&#39;;
				$post_type = &#39;&#39;;
				if ( isset( $request[&#39;post_type&#39;] ) ) {
					if ( is_array( $request[&#39;post_type&#39;] ) ) {
						$post_type = array_map( &#39;sanitize_text_field&#39;, $request[&#39;post_type&#39;] );
					} else {
						$post_type = sanitize_text_field( $request[&#39;post_type&#39;] );
					}
				}
				wp_send_json( self::get_existing_posts( absint( $request[&#39;course_id&#39;] ), $post_type, $term, $page ) );
			break;

		}// End switch().

		return array();

	}

	/**
	 * Do post locking stuff on the builder
	 * Locking the course edit main screen will lock the builder and vice versa... probably need to find a way
	 * to fix that but for now this&#39;ll work just fine and if you&#39;re unhappy about it, well, sorry...
	 *
	 * @param    int     $course_id  WP Post ID
	 * @return   void
	 * @since    3.13.0
	 * @version  3.13.0
	 */
	private static function handle_post_locking( $course_id ) {

		if ( ! wp_check_post_lock( $course_id ) ) {
			$active_post_lock = wp_set_post_lock( $course_id );
		}

		?&gt;&lt;input type=&#34;hidden&#34; id=&#34;post_ID&#34; value=&#34;&lt;?php echo absint( $course_id ); ?&gt;&#34;&gt;&lt;?php

if ( ! empty( $active_post_lock ) ) {
	?&gt;
	&lt;input type=&#34;hidden&#34; id=&#34;active_post_lock&#34; value=&#34;&lt;?php echo esc_attr( implode( &#39;:&#39;, $active_post_lock ) ); ?&gt;&#34; /&gt;
	&lt;?php
}

		add_filter( &#39;get_edit_post_link&#39;, array( __CLASS__, &#39;modify_take_over_link&#39; ), 10, 3 );
		add_action( &#39;admin_footer&#39;, &#39;_admin_notice_post_locked&#39; );

	}

	/**
	 * Handle AJAX Heartbeat received calls
	 * All builder data is sent through the heartbeat
	 * @param    array     $res   response data
	 * @param    array     $data  data from the heartbeat api
	 *                            builder data will be in the &#34;llms_builder&#34; array
	 * @return   array
	 * @since    3.16.0
	 * @version  3.24.2
	 */
	public static function heartbeat_received( $res, $data ) {

		// exit if there&#39;s no builder data in the heartbeat data
		if ( empty( $data[&#39;llms_builder&#39;] ) ) {
			return $res;
		}

		// Isolate builder data &amp; ensure slashes aren&#39;t removed.
		$data = $data[&#39;llms_builder&#39;];

		// Escape slashes.
		// $data = json_decode( str_replace( &#39;\\&#39;, &#39;\\\\&#39;, $data ), true );
		$data = json_decode( $data, true );

		// setup our return
		$ret = array(
			&#39;status&#39; =&gt; &#39;success&#39;,
			&#39;message&#39; =&gt; esc_html__( &#39;Success&#39;, &#39;lifterlms&#39; ),
		);

		// need a numeric ID for a course post type!
		if ( empty( $data[&#39;id&#39;] ) || ! is_numeric( $data[&#39;id&#39;] ) || &#39;course&#39; !== get_post_type( $data[&#39;id&#39;] ) ) {

			$ret[&#39;status&#39;] = &#39;error&#39;;
			$ret[&#39;message&#39;] = esc_html__( &#39;Error: Invalid or missing course ID.&#39;, &#39;lifterlms&#39; );

		} elseif ( ! current_user_can( &#39;edit_course&#39;, $data[&#39;id&#39;] ) ) {

			$ret[&#39;status&#39;] = &#39;error&#39;;
			$ret[&#39;message&#39;] = esc_html__( &#39;Error: You do not have permission to edit this course.&#39;, &#39;lifterlms&#39; );

		} else {

			if ( ! empty( $data[&#39;detach&#39;] ) &amp;&amp; is_array( $data[&#39;detach&#39;] ) ) {

				$ret[&#39;detach&#39;] = self::process_detachments( $data );

			}

			if ( current_user_can( &#39;delete_course&#39;, $data[&#39;id&#39;] ) ) {

				if ( ! empty( $data[&#39;trash&#39;] ) &amp;&amp; is_array( $data[&#39;trash&#39;] ) ) {

					$ret[&#39;trash&#39;] = self::process_trash( $data );

				}
			}

			if ( ! empty( $data[&#39;updates&#39;] ) &amp;&amp; is_array( $data[&#39;updates&#39;] ) ) {

				$ret[&#39;updates&#39;][&#39;sections&#39;] = self::process_updates( $data );

			}
		}

		// Unescape slashes after saved.
		// This ensures that updates are recognized as successful during Sync comparisons.
		// $ret = json_decode( str_replace( &#39;\\\\&#39;, &#39;\\&#39;, json_encode( $ret ) ), true );

		// Return our data.
		$res[&#39;llms_builder&#39;] = $ret;

		return $res;

	}

	/**
	 * Determine if an ID submitted via heartbeat data is a temporary id
	 * if so the object must be created rather than updated
	 * @param    string     $id  an ID string
	 * @return   bool
	 * @since    3.16.0
	 * @version  3.17.0
	 */
	public static function is_temp_id( $id ) {

		return ( ! is_numeric( $id ) &amp;&amp; 0 === strpos( $id, &#39;temp_&#39; ) );

	}

	/**
	 * Modify the &#34;Take Over&#34; link on the post locked modal to send users to the builder when taking over a course
	 * @param    string     $link     default post edit link
	 * @param    int        $post_id  WP Post ID of the course
	 * @param    string     $context  display context
	 * @return   string
	 * @since    3.13.0
	 * @version  3.13.0
	 */
	public static function modify_take_over_link( $link, $post_id, $context ) {

		return add_query_arg( array(
			&#39;page&#39; =&gt; &#39;llms-course-builder&#39;,
			&#39;course_id&#39; =&gt; $post_id,
		), admin_url( &#39;admin.php&#39; ) );

	}

	/**
	 * Output the page content
	 * @return   void
	 * @since    3.13.0
	 * @version  3.19.2
	 */
	public static function output() {

		global $post;

		$course_id = isset( $_GET[&#39;course_id&#39;] ) ? absint( $_GET[&#39;course_id&#39;] ) : null;
		if ( ! $course_id || ( $course_id &amp;&amp; &#39;course&#39; !== get_post_type( $course_id ) ) ) {
			_e( &#39;Invalid course ID&#39;, &#39;lifterlms&#39; );
			return;
		}

		$post = get_post( $course_id );

		$course = llms_get_post( $post );

		if ( ! current_user_can( &#39;edit_course&#39;, $course_id ) ) {
			_e( &#39;You cannot edit this course!&#39;, &#39;lifterlms&#39; );
			return;
		}

		remove_all_actions( &#39;the_title&#39; );
		remove_all_actions( &#39;the_content&#39; );

		global $llms_builder_lazy_load;
		$llms_builder_lazy_load = true;
		?&gt;

		&lt;div class=&#34;wrap lifterlms llms-builder&#34;&gt;

			&lt;?php do_action( &#39;llms_before_builder&#39;, $course_id ); ?&gt;

			&lt;div class=&#34;llms-builder-main&#34; id=&#34;llms-builder-main&#34;&gt;&lt;/div&gt;

			&lt;aside class=&#34;llms-builder-sidebar&#34; id=&#34;llms-builder-sidebar&#34;&gt;&lt;/aside&gt;

			&lt;?php
				$templates = array(
					&#39;assignment&#39;,
					&#39;course&#39;,
					&#39;editor&#39;,
					&#39;elements&#39;,
					&#39;lesson&#39;,
					&#39;lesson-settings&#39;,
					&#39;quiz&#39;,
					&#39;question&#39;,
					&#39;question-choice&#39;,
					&#39;question-type&#39;,
					&#39;section&#39;,
					&#39;settings-fields&#39;,
					&#39;sidebar&#39;,
					&#39;utilities&#39;,
				);

			foreach ( $templates as $template ) {
				echo self::get_template( $template, array(
					&#39;course_id&#39; =&gt; $course_id,
				) );
			}

			?&gt;

			&lt;script&gt;window.llms_builder = &lt;?php echo json_encode( array(
				&#39;admin_url&#39; =&gt; admin_url(),
				&#39;course&#39; =&gt; $course-&gt;toArray(),
				&#39;debug&#39; =&gt; array(
					&#39;enabled&#39; =&gt; ( defined( &#39;LLMS_BUILDER_DEBUG&#39; ) &amp;&amp; LLMS_BUILDER_DEBUG ),
				),
				&#39;questions&#39; =&gt; array_values( llms_get_question_types() ),
				&#39;schemas&#39; =&gt; self::get_custom_schemas(),
				&#39;sync&#39; =&gt; apply_filters( &#39;llms_builder_sync_settings&#39;, array(
					&#39;check_interval_ms&#39; =&gt; 10000,
				) ),
			) ); ?&gt;&lt;/script&gt;

			&lt;?php do_action( &#39;llms_after_builder&#39;, $course_id ); ?&gt;

		&lt;/div&gt;

		&lt;?php
		$llms_builder_lazy_load = false;
		self::handle_post_locking( $course_id );

	}

	/**
	 * Process lesson detachments from the heartbeat data
	 * @param    array     $data  array of lesson ids
	 * @return   array
	 * @since    3.16.0
	 * @version  3.27.0
	 */
	private static function process_detachments( $data ) {

		$ret = array();

		foreach ( $data[&#39;detach&#39;] as $id ) {

			$res = array(
				&#39;error&#39; =&gt; sprintf( esc_html__( &#39;Unable to detach &#34;%s&#34;. Invalid ID.&#39;, &#39;lifterlms&#39; ), $id ),
				&#39;id&#39; =&gt; $id,
			);

			$type = get_post_type( $id );

			$post_types = apply_filters( &#39;llms_builder_detachable_post_types&#39;, array( &#39;lesson&#39;, &#39;llms_question&#39;, &#39;llms_quiz&#39; ) );
			if ( ! is_numeric( $id ) || ! in_array( $type, $post_types ) ) {
				array_push( $ret, $res );
				continue;
			}

			$post = llms_get_post( $id );
			if ( ! is_a( $post, &#39;LLMS_Post_Model&#39; ) ) {
				array_push( $ret, $res );
				continue;
			}

			if ( &#39;lesson&#39; === $type ) {
				$post-&gt;set( &#39;parent_course&#39;, &#39;&#39; );
				$post-&gt;set( &#39;parent_section&#39;, &#39;&#39; );
			} elseif ( &#39;llms_question&#39; === $type ) {
				$post-&gt;set( &#39;parent_id&#39;, &#39;&#39; );
			} elseif ( &#39;llms_quiz&#39; === $type ) {
				$parent = $post-&gt;get_lesson();
				if ( $parent ) {
					$parent-&gt;set( &#39;quiz_enabled&#39;, &#39;no&#39; );
					$parent-&gt;set( &#39;quiz&#39;, &#39;&#39; );
					$post-&gt;set( &#39;lesson_id&#39;, 0 );
				}
			}

			do_action( &#39;llms_builder_detach_&#39; . $type, $post );

			unset( $res[&#39;error&#39;] );
			array_push( $ret, $res );

		}// End foreach().

		return $ret;

	}

	/**
	 * Delete/trash elements from heartbeat data
	 * @param    array     $data  array of ids to trash/delete
	 * @return   array
	 * @since    3.16.0
	 * @version  3.17.1
	 */
	private static function process_trash( $data ) {

		$ret = array();

		foreach ( $data[&#39;trash&#39;] as $id ) {

			$res = array(
				&#39;error&#39; =&gt; sprintf( esc_html__( &#39;Unable to delete &#34;%s&#34;. Invalid ID.&#39;, &#39;lifterlms&#39; ), $id ),
				&#39;id&#39; =&gt; $id,
			);

			$custom = apply_filters( &#39;llms_builder_trash_custom_item&#39;, null, $res, $id );
			if ( $custom ) {
				array_push( $ret, $custom );
				continue;
			}

			if ( is_numeric( $id ) ) {

				$type = get_post_type( $id );

			} else {

				$type = &#39;question_choice&#39;;

			}

			$post_types = apply_filters( &#39;llms_builder_trashable_post_types&#39;, array( &#39;lesson&#39;, &#39;llms_quiz&#39;, &#39;llms_question&#39;, &#39;question_choice&#39;, &#39;section&#39; ) );
			if ( ! in_array( $type, $post_types ) ) {
				array_push( $ret, $res );
				continue;
			}

			// lessons, sections, &amp; questions passed as numeric WP Post IDs
			if ( is_numeric( $id ) ) {

				// delete sections
				if ( in_array( $type, array( &#39;section&#39;, &#39;llms_question&#39;, &#39;llms_quiz&#39; ) ) ) {
					$stat = wp_delete_post( $id, true );
				} // End if().
				else {
					$stat = wp_trash_post( $id );
				}
			} else {

				$split = explode( &#39;:&#39;, $id );
				$question = llms_get_post( $split[0] );
				if ( $question &amp;&amp; is_a( $question, &#39;LLMS_Question&#39; ) ) {
					$stat = $question-&gt;delete_choice( $split[1] );
				} else {
					$stat = false;
				}
			}

			// both functions return false on failure
			if ( ! $stat ) {
				$res[&#39;error&#39;] = sprintf( esc_html__( &#39;Error deleting %1$s &#34;%s&#34;.&#39;, &#39;lifterlms&#39; ), $type, $id );
			} else {
				unset( $res[&#39;error&#39;] );
			}

			array_push( $ret, $res );

		}// End foreach().

		return $ret;

	}

	/**
	 * Process all the update data from the heartbeat
	 * @param    array     $data  array of course updates (all the way down the tree)
	 * @return   array
	 * @since    3.16.0
	 * @version  3.16.0
	 */
	private static function process_updates( $data ) {

		$ret = array();

		if ( ! empty( $data[&#39;updates&#39;][&#39;sections&#39;] ) &amp;&amp; is_array( $data[&#39;updates&#39;][&#39;sections&#39;] ) ) {

			foreach ( $data[&#39;updates&#39;][&#39;sections&#39;] as $section_data ) {

				if ( ! isset( $section_data[&#39;id&#39;] ) ) {
					continue;
				}

				$ret[] = self::update_section( $section_data, $data[&#39;id&#39;] );

			}
		}

		return $ret;

	}

	/**
	 * Handle updating custom schema data
	 * @param    string     $type       model type (lesson, quiz, etc...)
	 * @param    obj        $post       LLMS_Post_Model object for the model being updated
	 * @param    array      $post_data  assoc array of raw data to update the model with
	 * @return   void
	 * @since    3.17.0
	 * @version  3.17.1
	 */
	public static function update_custom_schemas( $type, $post, $post_data ) {

		$schemas = self::get_custom_schemas();
		if ( empty( $schemas[ $type ] ) ) {
			return;
		}

		$groups = $schemas[ $type ];

		foreach ( $groups as $name =&gt; $group ) {

			// allow 3rd parties to manage their own custom save methods
			if ( apply_filters( &#39;llms_builder_update_custom_fields_group_&#39; . $name, false, $post, $post_data, $groups ) ) {
				continue;
			}

			foreach ( $group[&#39;fields&#39;] as $fields ) {

				foreach ( $fields as $field ) {

					$keys = array( $field[&#39;attribute&#39;] );
					if ( isset( $field[&#39;switch_attribute&#39;] ) ) {
						$keys[] = $field[&#39;switch_attribute&#39;];
					}

					foreach ( $keys as $attr ) {

						if ( isset( $post_data[ $attr ] ) ) {

							if ( isset( $field[&#39;sanitize_callback&#39;] ) ) {
								$val = call_user_func( $field[&#39;sanitize_callback&#39;], $val );
							} else {
								$val = sanitize_text_field( $post_data[ $attr ] );
							}

							$attr = isset( $field[&#39;attribute_prefix&#39;] ) ? $field[&#39;attribute_prefix&#39;] . $attr : $attr;
							update_post_meta( $post_data[&#39;id&#39;], $attr, $val );

						}
					}
				}
			}
		}

	}

	/**
	 * Update lesson from heartbeat data
	 * @param    array     $lessons  lesson data from heartbeat
	 * @param    obj       $section  instance of the parent LLMS_Section
	 * @return   array
	 * @since    3.16.0
	 * @version  3.17.0
	 */
	private static function update_lessons( $lessons, $section ) {

		$ret = array();

		foreach ( $lessons as $lesson_data ) {

			if ( ! isset( $lesson_data[&#39;id&#39;] ) ) {
				continue;
			}

			$res = array_merge( $lesson_data, array(
				&#39;orig_id&#39; =&gt; $lesson_data[&#39;id&#39;],
			) );

			// create a new lesson
			if ( self::is_temp_id( $lesson_data[&#39;id&#39;] ) ) {

				$lesson = new LLMS_Lesson( &#39;new&#39;, array(
					&#39;post_title&#39; =&gt; isset( $lesson_data[&#39;title&#39;] ) ? $lesson_data[&#39;title&#39;] : __( &#39;New Lesson&#39;, &#39;lifterlms&#39; ),
				) );

				// if the parent section was just created the lesson will have a temp id
				// replace it with the newly created section&#39;s real ID
				if ( ! isset( $lesson_data[&#39;parent_section&#39;] ) || self::is_temp_id( $lesson_data[&#39;parent_section&#39;] ) ) {
					$lesson_data[&#39;parent_section&#39;] = $section-&gt;get( &#39;id&#39; );
				}

				$created = true;

			} else {

				$lesson = llms_get_post( $lesson_data[&#39;id&#39;] );
				$created = false;

			}

			if ( empty( $lesson ) || ! is_a( $lesson, &#39;LLMS_Lesson&#39; ) ) {

				$res[&#39;error&#39;] = sprintf( esc_html__( &#39;Unable to update lesson &#34;%s&#34;. Invalid lesson ID.&#39;, &#39;lifterlms&#39; ), $lesson_data[&#39;id&#39;] );

			} else {

				// return the real ID (important when creating a new lesson)
				$res[&#39;id&#39;] = $lesson-&gt;get( &#39;id&#39; );

				$properties = array_merge( array_keys( $lesson-&gt;get_properties() ), array(
					&#39;content&#39;,
					&#39;title&#39;,
				) );

				$skip_props = apply_filters( &#39;llms_builder_update_lesson_skip_props&#39;, array( &#39;quiz&#39; ) );

				// update all updateable properties
				foreach ( $properties as $prop ) {
					if ( isset( $lesson_data[ $prop ] ) &amp;&amp; ! in_array( $prop, $skip_props ) ) {
						$lesson-&gt;set( $prop, $lesson_data[ $prop ] );
					}
				}

				// update all custom fields
				self::update_custom_schemas( &#39;lesson&#39;, $lesson, $lesson_data );

				// during clone&#39;s we want to ensure custom field data comes with the lesson
				if ( $created &amp;&amp; isset( $lesson_data[&#39;custom&#39;] ) ) {
					foreach ( $lesson_data[&#39;custom&#39;] as $custom_key =&gt; $custom_vals ) {
						foreach ( $custom_vals as $val ) {
							add_post_meta( $lesson-&gt;get( &#39;id&#39; ), $custom_key, maybe_unserialize( $val ) );
						}
					}
				}

				// ensure slug gets updated when changing title from default &#34;New Lesson&#34;
				if ( isset( $lesson_data[&#39;title&#39;] ) &amp;&amp; ! $lesson-&gt;has_modified_slug() ) {
					$lesson-&gt;set( &#39;name&#39;, sanitize_title( $lesson_data[&#39;title&#39;] ) );
				}

				if ( ! empty( $lesson_data[&#39;quiz&#39;] ) &amp;&amp; is_array( $lesson_data[&#39;quiz&#39;] ) ) {
					$res[&#39;quiz&#39;] = self::update_quiz( $lesson_data[&#39;quiz&#39;], $lesson );
				}
			}// End if().

			// allow 3rd parties to update custom data
			$res = apply_filters( &#39;llms_builder_update_lesson&#39;, $res, $lesson_data, $lesson, $created );

			array_push( $ret, $res );

		}// End foreach().

		return $ret;

	}

	/**
	 * Update quiz questions from heartbeat data
	 * @param    array     $questions  question data array
	 * @param    obj       $parent    instance of an LLMS_Quiz or LLMS_Question (group)
	 * @return   array
	 * @since    3.16.0
	 * @version  3.16.11
	 */
	private static function update_questions( $questions, $parent ) {

		$res = array();

		foreach ( $questions as $q_data ) {

			$ret = array_merge( $q_data, array(
				&#39;orig_id&#39; =&gt; $q_data[&#39;id&#39;],
			) );

			// remove temp id if we have one so we&#39;ll create a new question
			if ( self::is_temp_id( $q_data[&#39;id&#39;] ) ) {
				unset( $q_data[&#39;id&#39;] );
			}

			// remove choices because we&#39;ll add them individually after creation
			$choices = ( isset( $q_data[&#39;choices&#39;] ) &amp;&amp; is_array( $q_data[&#39;choices&#39;] ) ) ? $q_data[&#39;choices&#39;] : false;
			unset( $q_data[&#39;choices&#39;] );

			// remove child questions if it&#39;s a question group
			$questions = ( isset( $q_data[&#39;questions&#39;] ) &amp;&amp; is_array( $q_data[&#39;questions&#39;] ) ) ? $q_data[&#39;questions&#39;] : false;
			unset( $q_data[&#39;questions&#39;] );

			$question_id = $parent-&gt;questions()-&gt;update_question( $q_data );

			if ( ! $question_id ) {

				$ret[&#39;error&#39;] = sprintf( esc_html__( &#39;Unable to update question &#34;%s&#34;. Invalid question ID.&#39;, &#39;lifterlms&#39; ), $q_data[&#39;id&#39;] );

			} else {

				$ret[&#39;id&#39;] = $question_id;

				$question = $parent-&gt;questions()-&gt;get_question( $question_id );

				if ( $choices ) {

					$ret[&#39;choices&#39;] = array();

					foreach ( $choices as $c_data ) {

						$choice_res = array_merge( $c_data, array(
							&#39;orig_id&#39; =&gt; $c_data[&#39;id&#39;],
						) );

						unset( $c_data[&#39;question_id&#39;] );

						// remove the temp ID so that we create it if it&#39;s new
						if ( self::is_temp_id( $c_data[&#39;id&#39;] ) ) {
							unset( $c_data[&#39;id&#39;] );
						}

						$choice_id = $question-&gt;update_choice( $c_data );
						if ( ! $choice_id ) {
							$choice_res[&#39;error&#39;] = sprintf( esc_html__( &#39;Unable to update choice &#34;%s&#34;. Invalid choice ID.&#39;, &#39;lifterlms&#39; ), $c_data[&#39;id&#39;] );
						} else {
							$choice_res[&#39;id&#39;] = $choice_id;
						}

						array_push( $ret[&#39;choices&#39;], $choice_res );

					}
				} elseif ( $questions ) {

					$ret[&#39;questions&#39;] = self::update_questions( $questions, $question );

				}
			}// End if().

			array_push( $res, $ret );

		}// End foreach().

		return $res;

	}

	/**
	 * Update quizzes during heartbeats
	 * @param    array     $quiz_data  array of quiz updates
	 * @param    obj       $lesson     instance of the parent LLMS_Lesson
	 * @return   array
	 * @since    3.16.0
	 * @version  3.17.6
	 */
	private static function update_quiz( $quiz_data, $lesson ) {

		$res = array_merge( $quiz_data, array(
			&#39;orig_id&#39; =&gt; $quiz_data[&#39;id&#39;],
		) );

		// create a quiz
		if ( self::is_temp_id( $quiz_data[&#39;id&#39;] ) ) {

			$quiz = new LLMS_Quiz( &#39;new&#39; );

			// update existing quiz
		} else {

			$quiz = llms_get_post( $quiz_data[&#39;id&#39;] );

		}

		$lesson-&gt;set( &#39;quiz&#39;, $quiz-&gt;get( &#39;id&#39; ) );
		$lesson-&gt;set( &#39;quiz_enabled&#39;, &#39;yes&#39; );

		// we don&#39;t have a proper quiz to work with...
		if ( empty( $quiz ) || ! is_a( $quiz, &#39;LLMS_Quiz&#39; ) ) {

			$res[&#39;error&#39;] = sprintf( esc_html__( &#39;Unable to update quiz &#34;%s&#34;. Invalid quiz ID.&#39;, &#39;lifterlms&#39; ), $quiz_data[&#39;id&#39;] );

		} else {

			// return the real ID (important when creating a new quiz)
			$res[&#39;id&#39;] = $quiz-&gt;get( &#39;id&#39; );

			// if the parent lesson was just created the lesson will have a temp id
			// replace it with the newly created lessons&#39;s real ID
			if ( ! isset( $quiz_data[&#39;lesson_id&#39;] ) || self::is_temp_id( $quiz_data[&#39;lesson_id&#39;] ) ) {
				$quiz_data[&#39;lesson_id&#39;] = $lesson-&gt;get( &#39;id&#39; );
			}

			$properties = array_merge( array_keys( $quiz-&gt;get_properties() ), array(
				// &#39;content&#39;,
				&#39;status&#39;,
				&#39;title&#39;,
			) );

			// update all updateable properties
			foreach ( $properties as $prop ) {
				if ( isset( $quiz_data[ $prop ] ) ) {
					$quiz-&gt;set( $prop, $quiz_data[ $prop ] );
				}
			}

			if ( isset( $quiz_data[&#39;questions&#39;] ) &amp;&amp; is_array( $quiz_data[&#39;questions&#39;] ) ) {
				$res[&#39;questions&#39;] = self::update_questions( $quiz_data[&#39;questions&#39;], $quiz );
			}

			// update all custom fields
			self::update_custom_schemas( &#39;quiz&#39;, $quiz, $quiz_data );

		}// End if().

		return $res;

	}

	/**
	 * Update a section with data from the heartbeat
	 * @param    array     $section_data  array of section data
	 * @param    obj       $course_id     instance of the parent LLMS_Course
	 * @return   array
	 * @since    3.16.0
	 * @version  3.16.11
	 */
	private static function update_section( $section_data, $course_id ) {

		$res = array_merge( $section_data, array(
			&#39;orig_id&#39; =&gt; $section_data[&#39;id&#39;],
		) );

		// create a new section
		if ( self::is_temp_id( $section_data[&#39;id&#39;] ) ) {

			$section = new LLMS_Section( &#39;new&#39; );
			$section-&gt;set( &#39;parent_course&#39;, $course_id );

			// update existing section
		} else {

			$section = llms_get_post( $section_data[&#39;id&#39;] );

		}

		// we don&#39;t have a proper section to work with...
		if ( empty( $section ) || ! is_a( $section, &#39;LLMS_Section&#39; ) ) {
			$res[&#39;error&#39;] = sprintf( esc_html__( &#39;Unable to update section &#34;%s&#34;. Invalid section ID.&#39;, &#39;lifterlms&#39; ), $section_data[&#39;id&#39;] );
		} else {

			// return the real ID (important when creating a new section)
			$res[&#39;id&#39;] = $section-&gt;get( &#39;id&#39; );

			// run through all possible updated fields
			foreach ( array( &#39;order&#39;, &#39;title&#39; ) as $key ) {

				// update those that were sent through
				if ( isset( $section_data[ $key ] ) ) {

					$section-&gt;set( $key, $section_data[ $key ] );

				}
			}

			if ( isset( $section_data[&#39;lessons&#39;] ) &amp;&amp; is_array( $section_data[&#39;lessons&#39;] ) ) {

				$res[&#39;lessons&#39;] = self::update_lessons( $section_data[&#39;lessons&#39;], $section );

			}
		}

		return $res;

	}

}
</pre>
			</div>
			<p class="source-code-links">
				<span>
					<a href="#" class="show-complete-source">Expand full source code</a>
					<a href="#" class="less-complete-source">Collapse full source code</a>
				</span>
				<span><a href="https://github.com/gocodebox/lifterlms/blob/3.29.4/includes/admin/class.llms.admin.builder.php#L13">View on GitHub</a></span>
			</p>
			</section>

		<hr/>
		<section class="class-methods">
			<p class="toc-jump"><a href="#top">Top &uarr;</a></p><h2 class="toc-heading" id="methods" tabindex="-1">Methods <a href="#methods" class="anchor"><span aria-hidden="true">#</span><span class="screen-reader-text">Methods</span></a></h2>
			<ul>
									<li><a href="https://developer.lifterlms.com/reference/classes/llms_admin_builder/admin_bar_menu/">
							admin_bar_menu</a>
						&mdash; Add menu items to the WP Admin Bar to allow quiz returns to the dashboad from the course builder											</li>
									<li><a href="https://developer.lifterlms.com/reference/classes/llms_admin_builder/get_custom_schemas/">
							get_custom_schemas</a>
						&mdash; Retrieve custom field schemas											</li>
									<li><a href="https://developer.lifterlms.com/reference/classes/llms_admin_builder/get_existing_posts/">
							get_existing_posts</a>
						&mdash; Retrieve a list of lessons the current user is allowed to clone/attach Used for ajax searching to add existing lessons											</li>
									<li><a href="https://developer.lifterlms.com/reference/classes/llms_admin_builder/get_existing_posts_where/">
							get_existing_posts_where</a>
						&mdash; Search lessons by search term during existing lesson lookups											</li>
									<li><a href="https://developer.lifterlms.com/reference/classes/llms_admin_builder/get_template/">
							get_template</a>
						&mdash; Retrieve the HTML of a JS template											</li>
									<li><a href="https://developer.lifterlms.com/reference/classes/llms_admin_builder/handle_ajax/">
							handle_ajax</a>
						&mdash; A terrible Rest API for the course builder											</li>
									<li><a href="https://developer.lifterlms.com/reference/classes/llms_admin_builder/handle_post_locking/">
							handle_post_locking</a>
						&mdash; Do post locking stuff on the builder Locking the course edit main screen will lock the builder and vice versa.											</li>
									<li><a href="https://developer.lifterlms.com/reference/classes/llms_admin_builder/heartbeat_received/">
							heartbeat_received</a>
						&mdash; Handle AJAX Heartbeat received calls All builder data is sent through the heartbeat											</li>
									<li><a href="https://developer.lifterlms.com/reference/classes/llms_admin_builder/is_temp_id/">
							is_temp_id</a>
						&mdash; Determine if an ID submitted via heartbeat data is a temporary id if so the object must be created rather than updated											</li>
									<li><a href="https://developer.lifterlms.com/reference/classes/llms_admin_builder/modify_take_over_link/">
							modify_take_over_link</a>
						&mdash; Modify the &#34;Take Over&#34; link on the post locked modal to send users to the builder when taking over a course											</li>
									<li><a href="https://developer.lifterlms.com/reference/classes/llms_admin_builder/output/">
							output</a>
						&mdash; Output the page content											</li>
									<li><a href="https://developer.lifterlms.com/reference/classes/llms_admin_builder/process_detachments/">
							process_detachments</a>
						&mdash; Process lesson detachments from the heartbeat data											</li>
									<li><a href="https://developer.lifterlms.com/reference/classes/llms_admin_builder/process_trash/">
							process_trash</a>
						&mdash; Delete/trash elements from heartbeat data											</li>
									<li><a href="https://developer.lifterlms.com/reference/classes/llms_admin_builder/process_updates/">
							process_updates</a>
						&mdash; Process all the update data from the heartbeat											</li>
									<li><a href="https://developer.lifterlms.com/reference/classes/llms_admin_builder/update_custom_schemas/">
							update_custom_schemas</a>
						&mdash; Handle updating custom schema data											</li>
									<li><a href="https://developer.lifterlms.com/reference/classes/llms_admin_builder/update_lessons/">
							update_lessons</a>
						&mdash; Update lesson from heartbeat data											</li>
									<li><a href="https://developer.lifterlms.com/reference/classes/llms_admin_builder/update_questions/">
							update_questions</a>
						&mdash; Update quiz questions from heartbeat data											</li>
									<li><a href="https://developer.lifterlms.com/reference/classes/llms_admin_builder/update_quiz/">
							update_quiz</a>
						&mdash; Update quizzes during heartbeats											</li>
									<li><a href="https://developer.lifterlms.com/reference/classes/llms_admin_builder/update_section/">
							update_section</a>
						&mdash; Update a section with data from the heartbeat											</li>
							</ul>
		</section>
		<hr/>
	<section class="user-notes">
		<p class="toc-jump"><a href="#top">Top &uarr;</a></p><h2 class="toc-heading" id="user-contributed-notes" tabindex="-1">User Contributed Notes <a href="#user-contributed-notes" class="anchor"><span aria-hidden="true">#</span><span class="screen-reader-text">User Contributed Notes</span></a></h2>
		
<div id="comments" class="comments-area">

	
	
		
			<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title"> <small></small></h3><p>You must <a href="https://developer.lifterlms.com/wp-login.php?redirect_to=https%3A%2F%2Fdeveloper.lifterlms.com%2Freference%2Fclasses%2Fllms_admin_builder%2F%23respond">log in</a> before being able to contribute a note or feedback.</p>	</div><!-- #respond -->
		
	
</div><!-- #comments -->
	</section>
</div>
	<br/><br/><br/><hr/>Permalink: <input style="width:60%;" type="text" value="https://developer.lifterlms.com/reference/classes/llms_admin_builder/"/>

</article>

			
		
		</main><!-- #main -->
	</div><!-- #primary -->
	</div><!-- #content -->

</div><!-- #page -->

	<div class="main-footer" id="llms-footer">
		<div class="wrapper">
			&copy; 2014 - 2019 <a href="https://lifterlms.com">LifterLMS</a> &middot; <a href="https://lifterlms.com/privacy-policy/">Privacy Policy</a> &middot; <a href="https://lifterlms.com/terms-conditions/">Terms and Conditions</a>
		</div>
	</div>

	<link rel="stylesheet" id="buttons-css" href="../../../../s29765.pcdn.co/wp-includes/css/buttons.min.css" type="text/css" media="all"/>
<script type="text/javascript" src="../../../../s29765.pcdn.co/wp-content/themes/wporg-developer/js/navigation.js"></script>
<script type="text/javascript" src="../../../../s29765.pcdn.co/wp-content/themes/wporg-developer/js/skip-link-focus-fix.js"></script>
<script type="text/javascript" src="../../../../s29765.pcdn.co/wp-content/themes/wporg-developer/js/search.js"></script>
<script type="text/javascript" src="../../../../s29765.pcdn.co/wp-content/themes/wporg-developer/js/menu.js"></script>
<script type="text/javascript" src="../../../../s29765.pcdn.co/wp-content/themes/wporg-developer/js/awesomplete.min.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var autocomplete = {"ajaxurl":"https:\/\/developer.lifterlms.com\/wp-admin\/admin-ajax.php","nonce":"c0e1df32b0"};
/* ]]> */
</script>
<script type="text/javascript" src="../../../../s29765.pcdn.co/wp-content/themes/wporg-developer/js/autocomplete.js"></script>
<script type="text/javascript" src="../../../../s29765.pcdn.co/wp-content/themes/wporg-developer/js/function-reference.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var quicktagsL10n = {"closeAllOpenTags":"Close all open tags","closeTags":"close tags","enterURL":"Enter the URL","enterImageURL":"Enter the URL of the image","enterImageDescription":"Enter a description of the image","textdirection":"text direction","toggleTextdirection":"Toggle Editor Text Direction","dfw":"Distraction-free writing mode","strong":"Bold","strongClose":"Close bold tag","em":"Italic","emClose":"Close italic tag","link":"Insert link","blockquote":"Blockquote","blockquoteClose":"Close blockquote tag","del":"Deleted text (strikethrough)","delClose":"Close deleted text tag","ins":"Inserted text","insClose":"Close inserted text tag","image":"Insert image","ul":"Bulleted list","ulClose":"Close bulleted list tag","ol":"Numbered list","olClose":"Close numbered list tag","li":"List item","liClose":"Close list item tag","code":"Code","codeClose":"Close code tag","more":"Insert Read More tag"};
/* ]]> */
</script>
<script type="text/javascript" src="../../../../s29765.pcdn.co/wp-includes/js/quicktags.min.js"></script>
<script type="text/javascript" src="../../../../s29765.pcdn.co/wp-content/themes/wporg-developer/js/user-notes.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wporg_note_feedback = {"show":"Show Feedback","hide":"Hide Feedback"};
/* ]]> */
</script>
<script type="text/javascript" src="../../../../s29765.pcdn.co/wp-content/themes/wporg-developer/js/user-notes-feedback.js"></script>
<script type="text/javascript" src="../../../../s29765.pcdn.co/wp-content/themes/wporg-developer/js/tabs.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wporg_note_preview = {"ajaxurl":"https:\/\/developer.lifterlms.com\/wp-admin\/admin-ajax.php","nonce":"bf6fb03126","preview":"preview note","preview_empty":"Nothing to preview","is_admin":""};
/* ]]> */
</script>
<script type="text/javascript" src="../../../../s29765.pcdn.co/wp-content/themes/wporg-developer/js/user-notes-preview.js"></script>
<script type="text/javascript" src="../../../../s29765.pcdn.co/wp-includes/js/wp-embed.min.js"></script>

		<script type="text/javascript">
		tinyMCEPreInit = {
			baseURL: "https://developer.lifterlms.com/wp-includes/js/tinymce",
			suffix: ".min",
						mceInit: {},
			qtInit: {'comment':{id:"comment",buttons:"strong,em,ul,ol,li"}},
			ref: {plugins:"",theme:"modern",language:""},
			load_ext: function(url,lang){var sl=tinymce.ScriptLoader;sl.markDone(url+'/langs/'+lang+'.js');sl.markDone(url+'/langs/'+lang+'_dlg.js');}
		};
		</script>
				<script type="text/javascript">
		var ajaxurl = "/wp-admin/admin-ajax.php";
		( function() {
			var init, id, $wrap;

			if ( typeof tinymce !== 'undefined' ) {
				if ( tinymce.Env.ie && tinymce.Env.ie < 11 ) {
					tinymce.$( '.wp-editor-wrap ' ).removeClass( 'tmce-active' ).addClass( 'html-active' );
					return;
				}

				for ( id in tinyMCEPreInit.mceInit ) {
					init = tinyMCEPreInit.mceInit[id];
					$wrap = tinymce.$( '#wp-' + id + '-wrap' );

					if ( ( $wrap.hasClass( 'tmce-active' ) || ! tinyMCEPreInit.qtInit.hasOwnProperty( id ) ) && ! init.wp_skip_init ) {
						tinymce.init( init );

						if ( ! window.wpActiveEditor ) {
							window.wpActiveEditor = id;
						}
					}
				}
			}

			if ( typeof quicktags !== 'undefined' ) {
				for ( id in tinyMCEPreInit.qtInit ) {
					quicktags( tinyMCEPreInit.qtInit[id] );

					if ( ! window.wpActiveEditor ) {
						window.wpActiveEditor = id;
					}
				}
			}
		}());
		</script>
			

</body></html>